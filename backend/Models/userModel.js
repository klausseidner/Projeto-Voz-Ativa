///////////////////////////////////////////////////////////////////////////////////////////////////////
// Aquivo de modelo de Usuário
///////////////////////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////////////////////////////
// Importando dependências necessárias
///////////////////////////////////////////////////////////////////////////////////////////////////////
const { db } = require('../config/db'); // Importando a conexão com o banco de dados

///////////////////////////////////////////////////////////////////////////////////////////////////////
// Lógica para criar um usuário
///////////////////////////////////////////////////////////////////////////////////////////////////////
async function createUser(data) {
  const { nome, email, senha, cpf, telefone, endereco, nivel, matricula } = data; // Capturando os dados do usuário
  const sql = 'INSERT INTO usuarios (nome, email, senha, cpf, telefone, endereco, nivel, matricula) VALUES (?, ?, ?, ?, ?, ?, ?, ?)'; // Criando a query SQL para inserir um novo usuário
  return db.query(sql, [nome, email, senha, cpf, telefone, endereco, nivel, matricula]); // Executando a query SQL
}

///////////////////////////////////////////////////////////////////////////////////////////////////////
// Lógica para buscar um usuário por email
///////////////////////////////////////////////////////////////////////////////////////////////////////
async function findUserByEmail(email) {
  const sql = 'SELECT * FROM usuarios WHERE email = ?'; // Criando a query SQL para buscar um usuário por email
  const [results] = await db.query(sql, [email]); // Executando a query SQL
  return results[0]; // Retorna o primeiro usuário encontrado
}

///////////////////////////////////////////////////////////////////////////////////////////////////////
// Lógica para atualizar o perfil do usuário
///////////////////////////////////////////////////////////////////////////////////////////////////////
async function updateProfile(userId, data) {
  const { nome, email, matricula, telefone, endereco } = data; // Capturando os dados do usuário
  const sql = 'UPDATE usuarios SET nome = ?, email = ?, matricula = ?, telefone = ?, endereco = ? WHERE id = ?'; // Criando a query SQL para atualizar o perfil do usuário
  return db.query(sql, [nome, email, matricula, telefone, endereco, userId]); // Executando a query SQL
}

///////////////////////////////////////////////////////////////////////////////////////////////////////
// Lógica para obter todos os usuários
///////////////////////////////////////////////////////////////////////////////////////////////////////
async function getAllUsers() {
  const sql = 'SELECT * FROM usuarios'; // Criando a query SQL para buscar todos os usuários
  const [results] = await db.query(sql); // Executando a query SQL
  return results; // Retorna todos os usuários
}

///////////////////////////////////////////////////////////////////////////////////////////////////////
// Lógica para deletar um usuário
///////////////////////////////////////////////////////////////////////////////////////////////////////
async function deleteUser(userId) {
  const sql = 'DELETE FROM usuarios WHERE id = ?'; // Criando a query SQL para deletar um usuário
  return db.query(sql, [userId]); // Executando a query SQL
}

///////////////////////////////////////////////////////////////////////////////////////////////////////
// Exportando todas as funções necessárias
///////////////////////////////////////////////////////////////////////////////////////////////////////
module.exports = {
  createUser,
  findUserByEmail,
  updateProfile,
  getAllUsers,
  deleteUser,
};

///////////////////////////////////////////////////////////////////////////////////////////////////////